# -*- makefile -*-

# Some targets used in leaf makefiles 

# some aliases for standard targets
distclean: realclean
clobber:   realclean


# This is the central place of specifying which files to clean
# As every C++ compiler leaves different stuff behind when dealing
# with templates, it is wise to concentrate this information.
# Intended usage is 
# clean: stdclean

stdclean: moduleclean
	rm -f *~ *.o  *.d *.ti *.ii
	find . -name "*~" -exec rm {} \; -print
	rm -rf ti_files # KCC template DB
	rm -f .nfs*     # NFS garbage
	rm -f *.tmp
	rm -f doxy.log 

install-libs:
	mkdir -p $(PREFIX)/lib/$(LIBPATH)
	cp $(ROOT)/lib/$(LIBPATH)/lib*  $(PREFIX)/lib/$(LIBPATH)

install: install-headers 


# targets to generate documentation using doxygen

doc: predoc postdoc

predoc:  doxy additional-predoc
postdoc: installdox additional-postdoc

# hook for module-specific additional docs
additional-predoc:
additional-postdoc:



DOCROOT=$(ALLROOT)
DOXYPATH=doxygen/html
RELPATH=../../..#
ADDRELPATH=#
RELROOT=$(RELPATH)/$(ADDRELPATH)
doxy:
	$(CONFIGURATION)/doxycfg/filter-doxy-cfg.pl -root $(ALLROOT) \
        $(CONFIGURATION)/doxycfg/doxy.paths.cfg                  > doxy.cfg.tmp
	echo "@INCLUDE_PATH = $(CONFIGURATION)/doxycfg/"        >> doxy.cfg.tmp
	cat doxy.local.cfg                                      >> doxy.cfg.tmp
	$(SCRIPTS)/generate-doxycfg.pl -root $(ALLROOT)  dependencies >> doxy.cfg.tmp
	cp $(CONFIGURATION)/doxycfg/footer.html .
	mkdir -p doxygen
	(TEXINPUTS=$(TEXINPUTS):$(ROOT):$(CONFIGURATION)/tex; export TEXINPUTS; \
         doxygen doxy.cfg.tmp;)
	rm footer.html
	rm -f doxy.cfg.tmp 

installdox:
	$(SCRIPTS)/generate-installdox.pl -root $(RELROOT) -path $(DOXYPATH)\
          dependencies > installdox.sh.tmp;
	chmod ugo+x ./installdox.sh.tmp;
	./installdox.sh.tmp
	rm -f installdox.sh.tmp

# suffix rules

.PHONY: doc test demo

.SUFFIXES: .C .cc .d .f

.C.o: 
	$(CC) $(CCFLAGS) $(IFLAGS) -c $<

.cc.o: 
	$(CC) $(CCFLAGS) $(IFLAGS) -c $<

.C.d:
	$(DEPEND) $(DEPFLAGS) $(IFLAGS) $<  > $@
